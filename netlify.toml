[build]
  command = "npm install && cd web-client && npm install && npm run build"
  publish = "web-client/.next"

[build.environment]
  NODE_VERSION = "18"
  NPM_FLAGS = "--legacy-peer-deps"
  NEXT_PUBLIC_SUPABASE_URL = "https://pznzykwfboqryuibelqs.supabase.co"
  NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6bnp5a3dmYm9xcnl1aWJlbHFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNTk3MjUsImV4cCI6MjA3NDkzNTcyNX0.BIdyGbIUTzGdMSp7PI9gNiwmLgUmcD9jqBU7LHH5YIU"
  NEXT_PUBLIC_FIREBASE_API_KEY = "AIzaSyCmm7pGnSM2FQCiIQtFBowhaXP2xHpO-6I"
  NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN = "madameai.firebaseapp.com"
  NEXT_PUBLIC_FIREBASE_DATABASE_URL = "https://madameai-default-rtdb.firebaseio.com"
  NEXT_PUBLIC_FIREBASE_PROJECT_ID = "madameai"
  NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET = "madameai.firebasestorage.app"
  NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID = "96843253648"
  NEXT_PUBLIC_FIREBASE_APP_ID = "1:96843253648:web:ddac677180656d17e15515"
  NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID = "G-6WL3CJKEN0"
  FIREBASE_DATABASE_URL = "https://madameai-default-rtdb.firebaseio.com"

[context.production.environment]
  NEXT_PUBLIC_SUPABASE_URL = "https://pznzykwfboqryuibelqs.supabase.co"
  NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6bnp5a3dmYm9xcnl1aWJlbHFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNTk3MjUsImV4cCI6MjA3NDkzNTcyNX0.BIdyGbIUTzGdMSp7PI9gNiwmLgUmcD9jqBU7LHH5YIU"
  NEXT_PUBLIC_FIREBASE_API_KEY = "AIzaSyCmm7pGnSM2FQCiIQtFBowhaXP2xHpO-6I"
  NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN = "madameai.firebaseapp.com"
  NEXT_PUBLIC_FIREBASE_DATABASE_URL = "https://madameai-default-rtdb.firebaseio.com"
  NEXT_PUBLIC_FIREBASE_PROJECT_ID = "madameai"
  NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET = "madameai.firebasestorage.app"
  NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID = "96843253648"
  NEXT_PUBLIC_FIREBASE_APP_ID = "1:96843253648:web:ddac677180656d17e15515"
  NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID = "G-6WL3CJKEN0"
  FIREBASE_DATABASE_URL = "https://madameai-default-rtdb.firebaseio.com"

# Use Netlify's Next.js plugin for proper routing
[[plugins]]
  package = "@netlify/plugin-nextjs"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[functions]
  directory = "api"
  node_bundler = "esbuild"

[functions.environment]
  SPEECHACE_API_ENDPOINT = "https://api.speechace.co"
  SPEECHACE_REGION = "us-west"
  NEXT_PUBLIC_SUPABASE_URL = "https://pznzykwfboqryuibelqs.supabase.co"
  NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6bnp5a3dmYm9xcnl1aWJlbHFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNTk3MjUsImV4cCI6MjA3NDkzNTcyNX0.BIdyGbIUTzGdMSp7PI9gNiwmLgUmcD9jqBU7LHH5YIU"
  NEXT_PUBLIC_FIREBASE_API_KEY = "AIzaSyCmm7pGnSM2FQCiIQtFBowhaXP2xHpO-6I"
  NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN = "madameai.firebaseapp.com"
  NEXT_PUBLIC_FIREBASE_DATABASE_URL = "https://madameai-default-rtdb.firebaseio.com"
  NEXT_PUBLIC_FIREBASE_PROJECT_ID = "madameai"
  NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET = "madameai.firebasestorage.app"
  NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID = "96843253648"
  NEXT_PUBLIC_FIREBASE_APP_ID = "1:96843253648:web:ddac677180656d17e15515"
  NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID = "G-6WL3CJKEN0"
  FIREBASE_PROJECT_ID = "madameai"
  FIREBASE_CLIENT_EMAIL = "firebase-adminsdk@madameai.iam.gserviceaccount.com"
  FIREBASE_PRIVATE_KEY = "-----BEGIN PRIVATE KEY-----\\nPLEASE_PROVIDE_SERVICE_ACCOUNT_PRIVATE_KEY\\n-----END PRIVATE KEY-----\\n"
  FIREBASE_DATABASE_URL = "https://madameai-default-rtdb.firebaseio.com"
  FIREBASE_STORAGE_BUCKET = "madameai.firebasestorage.app"

# IMPORTANT: Set these sensitive keys in Netlify UI (Site settings > Environment variables):
#
# Required API Keys:
# - OPENAI_API_KEY: Your OpenAI API key for AI generation
# - SPEECHACE_API_KEY: Your SpeechAce API key for pronunciation analysis
# - ELEVENLABS_API_KEY: Your ElevenLabs API key for text-to-speech
# - SUPABASE_SERVICE_ROLE_KEY: Your Supabase service role key (bypasses RLS for server operations)
#
# How to add:
# 1. Go to: https://app.netlify.com/sites/francoflex-pronunciation-ai/settings/env
# 2. Click "Add a variable"
# 3. Add each key-value pair
# 4. Redeploy the site
#
# To get SUPABASE_SERVICE_ROLE_KEY:
# 1. Go to: https://supabase.com/dashboard/project/pznzykwfboqryuibelqs/settings/api
# 2. Copy the "service_role" key (NOT the anon key)
# 3. Add to Netlify environment variables
